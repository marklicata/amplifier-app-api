# Production Docker Compose Override
# Usage: docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d

services:
  amplifier-service:
    environment:
      # Override dev settings for production
      LOG_LEVEL: info

      # Database
      DATABASE_PASSWORD: $(az account get-access-token --resource https://ossrdbms-aad.database.windows.net --query accessToken --output tsv)

      
      # Telemetry - Production settings
      TELEMETRY_ENVIRONMENT: production
      TELEMETRY_SAMPLE_RATE: 1.0
      TELEMETRY_ENABLE_DEV_LOGGER: false
      TELEMETRY_APP_INSIGHTS_CONNECTION_STRING: InstrumentationKey=48206f3f-4628-4533-bac0-e37fe3753d26;IngestionEndpoint=https://eastus-8.in.applicationinsights.azure.com/;LiveEndpoint=https://eastus.livediagnostics.monitor.azure.com/;ApplicationId=fff618d3-3995-4fba-8598-e876efe15767

      # Authentication Settings
      AUTH_MODE: api_key_jwt
      AUTH_REQUIRED: true
      API_KEY_HEADER: X-API-Key
      
      # Security - MUST override these
      SECRET_KEY: ${SECRET_KEY}  # Required: Generate with openssl rand -hex 32
      
      # Production CORS - Restrict to your domains
      ALLOWED_ORIGINS: https://yourdomain.com,https://api.yourdomain.com
      
      # Rate limiting - More restrictive in prod
      RATE_LIMIT_REQUESTS_PER_MINUTE: 30
    
    restart: always
    
    # Production healthcheck - more frequent
    healthcheck:
      interval: 15s
      timeout: 5s
      retries: 5
      start_period: 30s
