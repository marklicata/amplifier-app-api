# Production Docker Compose Override
# Usage: docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d

services:
  amplifier-service:
    environment:
      # Override dev settings for production
      LOG_LEVEL: info

      # Authentication - Production Settings
      #############################################
      AUTH_REQUIRED: false  # Set to true for production authentication.
      #############################################

      # Database - Production settings
      DATABASE_HOST: amplifier-api-db-prod.postgres.database.azure.com
      DATABASE_USER: amplifierdbprod@amplifier-api-db-prod
      DATABASE_PASSWORD: ${DATABASE_PASSWORD:-}
      DATABASE_PORT: 5432
      DATABASE_NAME: postgres
      DATABASE_SSL_MODE: require

      # Telemetry - Production settings
      TELEMETRY_ENVIRONMENT: production
      TELEMETRY_SAMPLE_RATE: 0.1  # Sample 10% in production
      TELEMETRY_ENABLE_DEV_LOGGER: false
      TELEMETRY_APP_INSIGHTS_CONNECTION_STRING: ${APP_INSIGHTS_CONNECTION_STRING}
           
      # Config Encryption
      CONFIG_ENCRYPTION_KEY: 22600d1d658220ce475612a0eb4d81f9169e9928102e68b479c695414debc808

      # Production CORS - Restrict to your domains
      ALLOWED_ORIGINS: https://yourdomain.com,https://api.yourdomain.com
      
      # Rate limiting - More restrictive in prod
      RATE_LIMIT_REQUESTS_PER_MINUTE: 30
    
    restart: always
    
    # Production healthcheck - more frequent
    healthcheck:
      interval: 15s
      timeout: 5s
      retries: 5
      start_period: 30s
